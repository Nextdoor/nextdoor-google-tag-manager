___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "categories": [
    "ADVERTISING",
    "ANALYTICS",
    "ATTRIBUTION",
    "CONVERSIONS",
    "MARKETING"
  ],
  "id": "ndp",
  "version": 1,
  "securityGroups": [
    "NON_GOOGLE_SCRIPTS"
  ],
  "displayName": "Nextdoor Universal Pixel",
  "brand": {
    "id": "brand_nextdoor",
    "displayName": "Nextdoor Universal Pixel Template",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAygAAAMoCAYAAAAk9MTxAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAB4oSURBVHgB7d1PjNzlfcfx57dAHRHhUNVIEduC8clOK0MF5mSnxLaA5pCuTRUqhSXhEJCgDfgSTHyIkbJgpEqQRFiBSxBLD6lis6fGRDIhQC44KDYXnAuYtI4qQSQECqpL8HSeMUON7fX+3/nMzOslWd61x4gkcjTv+T7f39OURbB699ilH64YGStNubrV/ra0WteMNOXSVqtcWgAAgIHTft9/rGn/KE1zuP3NkYvKyReOPTB1rCxQU+apRsn/rhi5tymtG9rf3lAAAIDh1iqH28Hy/YXEypwDpRsmI03rPhMSAADg3Jqn2qHy4FxDZU6BcvnD278rTAAAgNlqlWb37x/Y/+BsXz+rQFn98NjqD1vNs+1XX1MAAADm5thFpfWl2UxTRmZ6wehDt3z9T03zG3ECAADM0+oP201x+UNjYzO98ILz/WY90tU0rcfaX36mAAAAzN9nmqb5p0u2fqG8f/D1X073omkDpRMnpbW7AAAALJKmlBvOFynnDJQ6emma8qMCAACwyGqkrNzy18fakXLkHL/3aXUhvu6ceFIXAACwZJry7kWt1t+euTh/1pL8h6X5hTgBAACWVLs5Ok8KPsOnjnid2jspM27WAwAALFhTPv+5rV9o3jv4+gv//0sf69x1Upo3CwAAwHKpR73+p3XVsd1T79ZvPzni9WEz8t0CAACwnFrl0j+tGLmv+21ngmJ6AgAA9MxpU5TOBOXDUm4oAAAAvXDaFKUTKE3T3FsAAAB6pFVaf1d/bhzvAgAAElx0ovXnI453AQAACT5aMTI20pTmmgIAANBjJ0vrmpFWKVcXAACAHmu3yeqR0pTVBQAAoMea9vBkpJ0pqwsAAECvNeXSkQIAAJCgJVAAAIAgAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAYAgUAAIghUAAAgBgCBQAAiCFQAACAGAIFAACIIVAAAIAY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AABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIIZAAQAAYggUAAAghkABAABiCBQAACCGQAEAAGIIFAAAIEYz+vC2VgEAAAhgggIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABADIECAADEECgAAEAMgQIAAMQQKAAAQAyBAgAAxBAoAABAjJGmKe8WAACAACOtIlAAAIAIx0aa0hwuAAAAPdY07UAprdZbBQAAoMdarXJkpFVaJigAAECA5vDIRSfKVAEAAOixj8rJF0aO7Z6qS/IvFAAAgF5pyuH/fmDq2Mipr5tfFgAAgF5pNd+vP3UC5cITJx9zHwoAANAr9XhX/bkTKJ1jXh8XCwAAwPJqnqrHu+pXI91fMkUBAAB6oT09ebD79SeBYooCAAAst6a0HuxOT059f4bRPdt+U1rlmgIAALC0jh1/4NmrTv+FkTNf8VGrtc1RLwAAYCnV5viotL505q+fFSh1vNJqtXYUAACAJXLyZOuO0492dV1wrhe/f/Do4c9tXdu0u+aGAgAAsIjq3snx70z96Fy/d8F0f+i9g0dfECkAAMBiqnHyXw9M7Z7+92fwVw+NjbVGmh+3WuXSAgAAMA9156RptXb85wNTT533dWUWPv/w2OoLSvOL9perCwAAwFy0yuGPmta2c+2cnGlWgdL1lw+P7W6V5rsFAABgBp2nA7da3z/fka6z/kyZo4+nKbvbX369AAAAnKEbJheeKI91LoSfy58t83QqVMoNTdPc23KxIwAADL12mLzQDpNfzidMPvlnlEXQjZX2P+6a9r/U1a26q9KyrwIAAIOoTkja7/nfbQ8rDrdOtt4qpXX4ohNlar5Rcrr/A+a6fwJFWkGFAAAAAElFTkSuQmCC"
  },
  "description": "The Nextdoor Universal Pixel helps advertisers measure the effectiveness of campaigns.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "pixel_id",
    "displayName": "Nextdoor Pixel ID(s)",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY",
        "errorMessage": "You must provide a Pixel ID"
      },
      {
        "type": "REGEX",
        "args": [
          "^\\s*([a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}\\s*,\\s*)*([a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12})\\s*$"
        ],
        "errorMessage": "Invalid Pixel ID Format"
      }
    ],
    "alwaysInSummary": true,
    "help": "Support multiple pixel IDs separated by commas, such as id1,id2"
  },
  {
    "type": "RADIO",
    "name": "event_name",
    "displayName": "Event Name",
    "radioItems": [
      {
        "value": "standard",
        "displayValue": "Standard",
        "subParams": [
          {
            "type": "SELECT",
            "name": "standard_event_name",
            "displayName": "",
            "macrosInSelect": false,
            "selectItems": [
              {
                "value": "ADD_TO_CART",
                "displayValue": "Add to Cart"
              },
              {
                "value": "ADD_TO_WISHLIST",
                "displayValue": "Add to Wishlist"
              },
              {
                "value": "INITIATE_CHECKOUT",
                "displayValue": "Initiate Checkout"
              },
              {
                "value": "LEAD",
                "displayValue": "Lead"
              },
              {
                "value": "PAGE_VIEW",
                "displayValue": "Page View"
              },
              {
                "value": "PURCHASE",
                "displayValue": "Purchase"
              },
              {
                "value": "SEARCH",
                "displayValue": "Search"
              },
              {
                "value": "SIGN_UP",
                "displayValue": "Sign Up"
              },
              {
                "value": "SUBSCRIBE",
                "displayValue": "Subscribe"
              },
              {
                "value": "VIEW_CONTENT",
                "displayValue": "View Content"
              }
            ],
            "simpleValueType": true,
            "alwaysInSummary": true,
            "defaultValue": "PAGE_VIEW"
          }
        ]
      },
      {
        "value": "custom",
        "displayValue": "Custom",
        "subParams": [
          {
            "type": "SELECT",
            "name": "custom_event_name",
            "displayName": "",
            "macrosInSelect": false,
            "selectItems": [
              {
                "value": "CUSTOM_CONVERSION_1",
                "displayValue": "Custom Conversion 1"
              },
              {
                "value": "CUSTOM_CONVERSION_2",
                "displayValue": "Custom Conversion 2"
              },
              {
                "value": "CUSTOM_CONVERSION_3",
                "displayValue": "Custom Conversion 3"
              },
              {
                "value": "CUSTOM_CONVERSION_4",
                "displayValue": "Custom Conversion 4"
              },
              {
                "value": "CUSTOM_CONVERSION_5",
                "displayValue": "Custom Conversion 5"
              },
              {
                "value": "CUSTOM_CONVERSION_6",
                "displayValue": "Custom Conversion 6"
              },
              {
                "value": "CUSTOM_CONVERSION_7",
                "displayValue": "Custom Conversion 7"
              },
              {
                "value": "CUSTOM_CONVERSION_8",
                "displayValue": "Custom Conversion 8"
              },
              {
                "value": "CUSTOM_CONVERSION_9",
                "displayValue": "Custom Conversion 9"
              },
              {
                "value": "CUSTOM_CONVERSION_10",
                "displayValue": "Custom Conversion 10"
              }
            ],
            "simpleValueType": true,
            "subParams": [],
            "alwaysInSummary": true
          },
          {
            "type": "TEXT",
            "name": "custom_event_nickname",
            "displayName": "Nickname",
            "simpleValueType": true,
            "alwaysInSummary": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "help": "Provide a descriptive name for your custom conversion."
          }
        ]
      },
      {
        "value": "variable",
        "displayValue": "Variable",
        "subParams": [
          {
            "type": "SELECT",
            "name": "variable_event_name",
            "displayName": "",
            "macrosInSelect": true,
            "selectItems": [],
            "simpleValueType": true
          }
        ]
      }
    ],
    "simpleValueType": true,
    "defaultValue": "standard"
  },
  {
    "type": "GROUP",
    "name": "custom_data",
    "displayName": "Custom Data",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "order_value",
        "displayName": "Order Value",
        "simpleValueType": true,
        "help": "ISO 4217 currency followed by the total numeric value (up to two decimal places) associated with the event."
      },
      {
        "type": "TEXT",
        "name": "order_id",
        "displayName": "Order ID",
        "simpleValueType": true,
        "help": "The order ID for this transaction."
      },
      {
        "type": "PARAM_TABLE",
        "name": "product_context",
        "displayName": "Product Context",
        "paramTableColumns": [
          {
            "param": {
              "type": "TEXT",
              "name": "id",
              "displayName": "ID",
              "simpleValueType": true
            },
            "isUnique": true
          },
          {
            "param": {
              "type": "TEXT",
              "name": "content_name",
              "displayName": "Content Name",
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "TEXT",
              "name": "quantity",
              "displayName": "Quantity",
              "simpleValueType": true
            },
            "isUnique": false
          },
          {
            "param": {
              "type": "TEXT",
              "name": "item_price",
              "displayName": "Item Price",
              "simpleValueType": true
            },
            "isUnique": false
          }
        ],
        "help": "A list of objects that contain the product IDs associated with the event plus information about the products."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "user_data",
    "displayName": "Advanced Matching User Attributes",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "user_attributes",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Type",
            "name": "type",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "city",
                "displayValue": "City (lowercase)"
              },
              {
                "value": "country",
                "displayValue": "Country (ISO 3166 name in lowercase)"
              },
              {
                "value": "date_of_birth",
                "displayValue": "Date of Birth (mmddyyyy)"
              },
              {
                "value": "email",
                "displayValue": "Email (lowercase)"
              },
              {
                "value": "external_id",
                "displayValue": "External ID"
              },
              {
                "value": "first_name",
                "displayValue": "First Name (lowercase, no space)"
              },
              {
                "value": "gender",
                "displayValue": "Gender (f for female, m for male, n for non-binary, or leave it empty if prefer not to say)"
              },
              {
                "value": "last_name",
                "displayValue": "Last Name (lowercase, no space)"
              },
              {
                "value": "phone_number",
                "displayValue": "Phone (no space, dash or parentheses)"
              },
              {
                "value": "state",
                "displayValue": "State (lowercase acronym, such as ca)"
              },
              {
                "value": "street_address",
                "displayValue": "Street (lowercase)"
              },
              {
                "value": "zip_code",
                "displayValue": "Postal Code"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "restricted_data_usage_options",
    "displayName": "Restricted Data Usage",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "restricted_data_usage",
        "checkboxText": "Restricted Data Usage (RDU)",
        "simpleValueType": true,
        "help": "Restrict Data Usage force this Nextdoor event to comply to regional regulations with regard to the processing and selling of user data."
      },
      {
        "type": "TEXT",
        "name": "restricted_data_usage_country",
        "displayName": "Country",
        "simpleValueType": true,
        "help": "A country that you want to associate with this data processing option. Current accepted values are\n- 1 for the United States of America",
        "enablingConditions": [
          {
            "paramName": "restricted_data_usage",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "restricted_data_usage_state",
        "displayName": "State",
        "simpleValueType": true,
        "help": "A state that you want to associate to this data processing option. Current accepted values are.\n- 1000 for California\n- 1001 for Colorado\n- 1002 for Connecticut\n- 1003 for Iowa\n- 1004 for Oregon\n- 1005 for Texas\n- 1006 for Montana\n- 1007 for Delaware\n- 1008 for Nebraska\n- 1009 for New Hampshire\n- 1010 for New Jersey\n- 1011 for Utah\n- 1012 for Virginia\n- 1013 for Minnesota\n- 1014 for Tennessee\n- 1015 for Maryland\n- 1016 for Indiana\n- 1017 for Kentucky\n- 1018 for Rhode Island",
        "enablingConditions": [
          {
            "paramName": "restricted_data_usage",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "settings",
    "displayName": "More Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "event_id",
        "displayName": "Event ID",
        "simpleValueType": true,
        "help": "Set the Event ID parameter when you plan to use the same event in the Conversion API. This field helps deduplicate events coming from multiple sources."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

var log = require('logToConsole');
var callInWindow = require('callInWindow');
var callLater = require('callLater');
var copyFromWindow = require('copyFromWindow');
var createQueue = require('createQueue');
var injectScript = require('injectScript');
var makeNumber = require('makeNumber');
var makeTableMap = require('makeTableMap');
var sendPixel = require('sendPixel');
var setInWindow = require('setInWindow');
var setCookie = require('setCookie');
var sha256 = require('sha256');
var getCookieValues = require('getCookieValues');

function mergeObjects() {
    var res = {};
    for(var i = 0; i < arguments.length; ++i) {
        for(var x in arguments[i]) {
            res[x] = arguments[i][x];
        }
    }
    return res;
}

function bootstrapFn() {
  var ndp = copyFromWindow('ndp');
  if (ndp) {
    return ndp;
  }

  setInWindow('ndp', function() {
    var handler = copyFromWindow('ndp.handleRequest');
    if (handler) {
      callInWindow('ndp.handleRequest.apply', null, arguments);
    } else {
      callInWindow('ndp.queue.push', arguments);
    }
  });
  return copyFromWindow('ndp');
}

// Checks whether a given string is likely to be a cryptographic hash
const isHash = (str) => {
  const hexRegex = '/^[a-fA-F0-9]+$/';
  const length = str.length;

  const knownHexHashes = {
    32: 'MD5',
    40: 'SHA-1',
    64: 'SHA-256',
    128: 'SHA-512',
  };
  // Check hex-based hashes
  if (knownHexHashes[length] && hexRegex.test(str)) {
    return true;
  }

  return false;
};

function bootstrap() {
  var ndp = bootstrapFn();
  createQueue('ndp.queue');
  setInWindow('ndp.sendPixelByGTM', sendPixel, true);
  setInWindow('ndp.getCookieValues', getCookieValues, true);
  setInWindow('ndp.v', 1, true);

  data.integration = "gtm";
  log("data = ", data);
  var additionalInitData = (data.additional_init_data) ? makeTableMap(data.additional_init_data, 'key', 'value') : {};
  var initData = mergeObjects(data, additionalInitData);

  if (data.restricted_data_usage) {
      ndp('restrictedDataUsage', makeNumber(data.restricted_data_usage_country), makeNumber(data.restricted_data_usage_state));
  }

  if (data.user_attributes) {
    data.user_attributes.forEach(attrs => {
      const type = attrs.type;
      const value = attrs.value;
      if (type === 'email') {
        if (isHash(value)) {
          initData.user_email_hash = value;
        } else {
          initData.user_email = value;
        }
      }
    });
  }

  var multi_pixel_list = data.pixel_id.split(",").map(pid => pid.trim());
  multi_pixel_list.forEach(pixelId => {
      ndp('init', pixelId, initData);
  });

  let event_params = {pixel_ids: multi_pixel_list};
  if (data.event_id) {
    event_params.event_id = data.event_id;
  }

  if (data.event_id) {

  }

  let custom_data = {
    order_value: data.order_value,
    order_id: data.order_id,
    product_context: data.product_context,
  };

  if (data.user_attributes) {
    data.user_attributes.forEach(attrs => {
      const type = attrs.type;
      const value = attrs.value;
      custom_data[type] = value;
    });
  }

  var event_name_final = 'PAGE_VIEW';
  if (initData.event_name == 'variable') {
    event_name_final = initData.variable_event_name;
  } else if (initData.event_name == 'custom') {
    event_name_final = initData.custom_event_name;
    if (data.custom_event_nickname) {
      event_params.nickname = data.custom_event_nickname;
    }
  } else {
    event_name_final = initData.standard_event_name;
  }

  ndp('track', event_name_final, event_params, custom_data);

  var url = 'https://ads.nextdoor.com/public/pixel/ndp.js?id=' + multi_pixel_list[0];
  injectScript(url, data.gtmOnSuccess, data.gtmOnFailure, url);
}

bootstrap();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ndp"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ndp.handleRequest"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ndp.handleRequest.apply"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ndp.queue"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ndp.queue.push"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ndp.sendPixelByGTM"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ndp.getCookieValues"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ndp.v"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://flask.nextdoor.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://ads.nextdoor.com/*"
              },
              {
                "type": 1,
                "string": "https://ads.nextdoor-test.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "ndclid"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Basic Test
  code: |-
    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: Standard Event Name
  code: "mockData = {pixel_id: '550e8400-e29b-41d4-a716-446655440000', event_name:\
    \ 'standard', standard_event_name: 'PURCHASE'};\n\nmock('copyFromWindow', key\
    \ => {\n  if (key === 'ndp') return function() {\n    if (arguments[0] === 'track')\
    \ {\n      assertThat(arguments[1], 'event name is correct').isEqualTo('PURCHASE');\n\
    \    }\n  };\n});\n     \n// Call runCode to run the template's code.\nrunCode(mockData);\n\
    \n// Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();"
- name: Custom Event Name
  code: "mockData = {pixel_id: '550e8400-e29b-41d4-a716-446655440000', event_name:\
    \ 'custom', custom_event_name: 'CUSTOM_CONVERSION_5', custom_event_nickname: 'test'};\n\
    \nmock('copyFromWindow', key => {\n  if (key === 'ndp') return function() {\n\
    \    if (arguments[0] === 'track') {\n      assertThat(arguments[1], 'event name\
    \ is correct').isEqualTo('CUSTOM_CONVERSION_5');\n      assertThat(arguments[2].nickname,\
    \ 'event nickname is correct').isEqualTo('test');\n    }\n  };\n});\n     \n//\
    \ Call runCode to run the template's code.\nrunCode(mockData);\n\n// Verify that\
    \ the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();"
- name: Variable Event Name
  code: "mockData = {pixel_id: '550e8400-e29b-41d4-a716-446655440000', event_name:\
    \ 'variable', variable_event_name: 'add_to_cart'};\n\nmock('copyFromWindow', key\
    \ => {\n  if (key === 'ndp') return function() {\n    if (arguments[0] === 'track')\
    \ {\n      assertThat(arguments[1], 'event name is correct').isEqualTo('add_to_cart');\n\
    \    }\n  };\n});\n     \n// Call runCode to run the template's code.\nrunCode(mockData);\n\
    \n// Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();"
- name: Multi Pixel
  code: "mock('copyFromWindow', key => {\n  if (key === 'ndp') return function() {\n\
    \    if (arguments[0] === 'track') {\n      assertThat(arguments[2], 'Pixel ID\
    \ list is correct').isEqualTo({pixel_ids: ['550e8400-e29b-41d4-a716-446655440000',\
    \ '87429417-4f47-4a99-8d32-2080ae007119']});\n    }\n  };\n});\n     \n// Call\
    \ runCode to run the template's code.\nrunCode(mockData);\n\n// Verify that the\
    \ tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();"
- name: Event ID
  code: |-
    mockData = {pixel_id: '550e8400-e29b-41d4-a716-446655440000', event_id: 'eventId'};

    mock('copyFromWindow', function(key) {
      if (key === 'ndp') {
        return function() {
          if (arguments[0] === 'track') {
            assertThat(arguments[2].event_id, 'eventID included in tracking call').isEqualTo(mockData.event_id);
          }
        };
      }
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: Custom Data
  code: "// Define your mock data\nmockData = {\n  pixel_id: '550e8400-e29b-41d4-a716-446655440000',\n\
    \  event_id: 'eventId', \n  order_value: \"USD412.21\",\n  order_id: \"ID-12213\"\
    ,\n  product_context: [\n    {\n      \"id\": \"F123\",\n      \"content_name\"\
    : \"Food\",\n      \"quantity\": \"2\",\n      \"item_price\": \"8.49\"\n    },\n\
    \    {\n      \"id\": \"D124\",\n      \"content_name\": \"Drink\",\n      \"\
    quantity\": \"1\",\n      \"item_price\": \"3.99\"\n    }\n  ]\n};\n\n// Define\
    \ expected result from mock data\nconst expected_data = {\n  order_value: mockData.order_value,\n\
    \  order_id: mockData.order_id,\n  product_context: mockData.product_context\n\
    };\n\n// Mock copyFromWindow function\nmock('copyFromWindow', (key) => {\n  if(key\
    \ === 'ndp') {\n    return function() {\n      if(arguments[0] === 'track') {\n\
    \        const custom_data = {\n          order_value: arguments[3].order_value,\n\
    \          order_id: arguments[3].order_id,\n          product_context: arguments[3].product_context\n\
    \        };\n        assertThat(custom_data, 'custom data is correctly included\
    \ in tracking call').isEqualTo(expected_data);\n      }\n    };\n  }\n});\n\n\
    // Run your code (assuming your code is under runCode function)\nrunCode(mockData);\n\
    \n// Verify that the success callback was called\nassertApi('gtmOnSuccess').wasCalled();"
setup: |-
  let mockData = {
    pixel_id: '550e8400-e29b-41d4-a716-446655440000, 87429417-4f47-4a99-8d32-2080ae007119',
    event_type: 'Page View',
  };

  const scriptUrl = 'https://ads.nextdoor.com/public/pixel/ndp.js';

  // Create injectScript mock
  let success, failure;
  mock('injectScript', (url, onsuccess, onfailure) => {
    success = onsuccess;
    failure = onfailure;
    onsuccess();
  });


___NOTES___

Created on 2/17/2021, 10:38:51 AM


